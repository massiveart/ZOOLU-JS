Function.prototype.bind||(Function.prototype.bind=function(e){if(typeof this!="function")throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,r=function(){},i=function(){return n.apply(this instanceof r?this:e||window,t.concat(Array.prototype.slice.call(arguments)))};r.prototype=this.prototype;i.prototype=new r;return i});window.log=function(){this.log.history=this.log.history||[];this.log.history.push(arguments);this.console&&this.console.log(Array.prototype.slice.call(arguments))};window.debug=!1;(function(e,t,n){"use strict";function r(){e.debug&&e.log.apply(e,t.merge(["ZOOLU"],arguments))}var i;i={version:"2.0.0.alpha1"};e.ZOOLU=e.$z=i})(window,window.jQuery);(function(e,t,n,r){"use strict";function i(){e.debug&&e.log.apply(e,n.merge(["ZOOLU","UTIL"],arguments))}t.UTIL={};t.UTIL.String={truncate:function(e,t){i("String","truncate");return typeof e!="string"?"":e.length>t?e.slice(0,t-3)+"...":e},truncateAtWordBoundaries:function(e,t){i("String","truncateAtWordBoundaries");var n,r;if(typeof e!="string")return"";n=e.split("");if(n.length>t){for(r=n.length-1;r>-1;--r)if(r>=t)n.length=r;else if(" "===n[r]){n.length=r;break}n.push(" ...")}return n.join("")},truncateInBetween:function(e,t,n){i("String","truncateAtTheMiddle");if(typeof e!="string")return"";if(e.length>t){n=n||" ... ";var r=n.length,s=t-r,o=Math.ceil(s/3*2),u=Math.floor(s/3*1);return e.substr(0,o)+n+e.substr(e.length-u)}return e}}})(window,window.ZOOLU,window.jQuery);(function(e,t,n,r){"use strict";function i(){e.debug&&e.log.apply(e,n.merge(["ZOOLU","MIXIN"],arguments))}t.MIXIN={};t.MIXIN.Events={enable:function(){this.listeners||(this.listeners={});this.trigger=function(e,n){t.MIXIN.Events.trigger.call(this,e,n)}.bind(this);this.on=function(e,n){t.MIXIN.Events.on.call(this,e,n)}.bind(this);this.off=function(e,n){t.MIXIN.Events.off.call(this,e,n)}.bind(this);i("Event API enabled")},trigger:function(t,n){if(!!this.listeners[t]){n===r&&(n=[]);for(var i=-1,s=this.listeners[t].length;++i<s;)this.listeners[t][i].apply(e,n)}},on:function(e,t){this.listeners[e]||(this.listeners[e]=[]);t instanceof Function&&this.listeners[e].push(t)},off:function(e,t){if(!!this.listeners[e]&&this.listeners[e].length>0)if(!t)this.listeners[e]=[];else{var n=[];for(var r=-1,i=this.listeners[e].length;++r<i;)t!==this.listeners[e][r]&&n.push(this.listeners[e][r]);this.listeners[e]=n}}}})(window,window.ZOOLU,window.jQuery);(function(e,t,n,r){"use strict";function i(){e.debug&&e.log.apply(e,n.merge(["ZOOLU","STORE"],arguments))}t.STORE={};t.STORE.Cookie=function(){function t(){i("Init ZOOLU.STORE.Cookies");var e=JSON.parse(n.cookie("ZOOLU"))||{};return{set:function(t,r){e[t]=r;n.cookie("ZOOLU",JSON.stringify(e))},get:function(t){return e[t]?e[t]:null}}}var e;return{getInstance:function(){e||(e=t());return e}}}()})(window,window.ZOOLU,window.jQuery);(function(e,t,n,r){"use strict";function i(){e.debug&&e.log.apply(e,n.merge(["ZOOLU","UI"],arguments))}t.UI={};t.UI.Exception=function(e){this.name="ZOOLU.UI.Exception";this.message=e||"Something went wrong!"};t.UI.Exception.prototype={constructor:t.UI.Exception,toString:function(){return this.name+': "'+this.message+'"'}};t.UI.ColumnTree=function(e,r){this.$container=n(e);if(!this.$container.length)throw new t.UI.Exception("ColumnTree container doesn't exist!");this.$container.addClass("column-tree");this.options=n.extend({hasChildren:{},urlAddOnForLoadingNodeChildren:"/children",rowMaxLength:30},r);this.level=0;this.selectedId=null;this.selectedElementIds=[];this.$selected=null;this.$currentColumn=null;this.data=[];t.MIXIN.Events.enable.call(this);i("ColumnTree","construct",this);this.load()};t.UI.ColumnTree.prototype={constructor:t.UI.ColumnTree,load:function(){i("ColumnTree","load");if(this.options.url){this.trigger("ColumnTree.load");this.$container.find(".column").length<=this.level&&this.addColumn();this.$currentColumn=n("#column-"+this.level);this.$currentColumn.addClass("busy");n.ajax({url:this.selectedId?this.options.url+"/"+this.selectedId+this.options.urlAddOnForLoadingNodeChildren:this.options.url,type:"GET",dataType:"JSON",success:function(e){i("ColumnTree","load","success",e);this.updateData(e);this.updateView()}.bind(this),error:function(e,t){i("ColumnTree","load","error",t);this.$currentColumn.removeClass("busy")}.bind(this)})}},updateData:function(e){i("ColumnTree","updateData");this.data[this.level]=e},updateView:function(){i("ColumnTree","updateView");if(!this.$currentColumn.length)throw new t.UI.Exception("Current column not found!");this.$currentColumn.removeClass("busy");this.$list=n('<ul class="list"/>');for(var e=-1,r=this.data[this.level].length;++e<r;)this.prepareRow(this.data[this.level][e]).appendTo(this.$list);this.$currentColumn.html(this.$list);delete this.$row;delete this.$list},addColumn:function(){i("ColumnTree","addColumn");this.$container.width(this.totalColumnWidth());this.$container.append(n('<div class="column"/>').attr("id","column-"+this.level).data("level",this.level))},totalColumnWidth:function(){var e=n(".column").outerWidth();this.$container.find(".column").each(function(){e+=n(this).outerWidth()});return e},prepareRow:function(e){i("ColumnTree","prepareRow",arguments);this.$row=n('<li class="row '+e.type+'"/>').attr("id","row-"+e.id+"-"+e.type);this.$row.html(t.UTIL.String.truncateInBetween(e.name,this.options.rowMaxLength));this.$row.data("id",e.id);this.$row.data("type",e.type);this.$row.data("level",this.level);this.attachRowObservers(e);return this.$row},attachRowObservers:function(){i("ColumnTree","attachRowObservers",arguments);this.$row.on("click",function(e){this.select(e.target)}.bind(this))},select:function(e){i("ColumnTree","select",arguments);this.$selected=n(e);this.selectedId=this.$selected.data("id");this.level=this.$selected.data("level");this.trigger("ColumnTree.select",[this.$selected]);this.updateSelectedMarker();this.$container.find(".column").each(function(e,t){if(n(t).data("level")>this.level){n(t).html("");delete this.data[n(t).data("level")];delete this.selectedElementIds[n(t).data("level")]}}.bind(this));if(this.options.hasChildren.hasOwnProperty(this.$selected.data("type"))&&this.options.hasChildren[this.$selected.data("type")]===!0){this.level++;this.load()}},updateSelectedMarker:function(){i("ColumnTree","updateSelectedMarker");if(this.selectedElementIds[this.level]){i(n("#"+this.selectedElementIds[this.level]));n("#"+this.selectedElementIds[this.level]).removeClass("selected")}this.$selected.addClass("selected");this.selectedElementIds[this.level]=this.$selected.attr("id")}};t.UI.Layout=function(e,r){this.$container=n(e);if(!this.$container.length)throw new t.UI.Exception("Layout container doesn't exist!");this.$container.addClass("layout");this.$container.addClass("busy");this.height=this.$container.outerHeight(!0);this.width=this.$container.outerWidth(!0);this.panels={};this.options=n.extend({fullScreen:!0},r);t.MIXIN.Events.enable.call(this);i("Layout","construct",this);this.initialize()};t.UI.Layout.prototype={constructor:t.UI.Layout,CONST:{orientations:["west","north","center"]},initialize:function(){var t;i("Layout","initialize");if(this.options.fullScreen){n("html").css({height:"100%",overflow:"hidden",overflowX:"hidden",overflowY:"hidden"});n("body").css({position:"relative",height:"100%",overflow:"hidden",overflowX:"hidden",overflowY:"hidden",margin:0,padding:0,border:"none"})}i("passed at");for(var r=-1,s=this.CONST.orientations.length;++r<s;){t=this.$container.find("> ."+this.CONST.orientations[r]);t.length&&this.initPanel(t.first(),this.CONST.orientations[r])}this.arrange();n(e).resize(this.arrange.bind(this))},enable:function(){this.initPanel=function(e,n){t.UI.Layout.prototype.initPanel.call(this,e,n)}.bind(this);this.addPanel=function(e){t.UI.Layout.prototype.addPanel.call(this,e)}.bind(this);this.arrange=function(){t.UI.Layout.prototype.arrange.call(this)}.bind(this)},initPanel:function(e,n){i("Layout","initPanel",arguments);this.addPanel(new t.UI.Layout.Panel(e,this,n,this.options))},addPanel:function(e){i("Layout","addPanel",arguments);this.panels[e.orientation]=e;e.on("Layout.Panel.resize",this.arrange.bind(this))},arrange:function(){this.layout?i("Layout","Panel","arrange"):i("Layout","arrange");this.updateDimension();this.left=0;if(this.panels.hasOwnProperty("west")){this.panels.west.setPositionLeft(this.left);this.left+=this.panels.west.width}this.top=0;if(this.panels.hasOwnProperty("north")){this.panels.north.setPositionTop(this.top);this.top+=this.panels.north.height}if(this.panels.hasOwnProperty("center")){this.panels.center.setPositionLeft(this.left);this.panels.center.setPositionTop(this.top);this.panels.center.updateDimension(this.left===0?"100%":this.width-this.left,this.top===0?"100%":this.height-this.top);this.panels.center.hasChildren&&this.panels.center.arrange()}this.unbusy()},unbusy:function(){this.$container.removeClass("busy")},updateDimension:function(e,t){!e||this.$container.width(e);!t||this.$container.height(t);this.height=this.$container.outerHeight(!0);this.width=this.$container.outerWidth(!0)}};t.UI.Layout.Panel=function(e,r,s,o){this.$element=n(e);this.layout=r;this.orientation=s;this.hasChildren=!1;this.handler=null;this.handlerCursor="";this.minimizer=null;this.closed=!1;this.tmpHeight=0;this.tmpWidth=0;if(!this.$element.length)throw new t.UI.Exception("Panel doesn't exist!");this.$element.addClass("panel");this.height=this.$element.outerHeight(!0);this.width=this.$element.outerWidth(!0);this.options=n.extend({minimizeHeight:5,minimizeWidth:50,minimizeOrientations:["north","west"],storeDimensions:!0},o);t.MIXIN.Events.enable.call(this);i("Layout","Panel","construct",this);this.initialize();if(this.orientation==="center"){t.UI.Layout.prototype.enable.call(this);this.panels={};this.initializeLayout()}};t.UI.Layout.Panel.prototype={constructor:t.UI.Layout.Panel,initialize:function(){if(this.options.storeDimensions===!0){this.store=t.STORE.Cookie.getInstance();i("PANEL."+this.orientation+".height",this.store.get("PANEL."+this.orientation+".height"));i("PANEL."+this.orientation+".width",this.store.get("PANEL."+this.orientation+".width"))}this.applyStoredDimensions();this.$handler=n('<div class="handler"/>');this.$handler.appendTo(this.$element);this.$handlerCursor=this.$handler.css("cursor");this.addMinimizer(this.$handler,this.options.minimizeOrientations);this.$minimizer.click(function(e){e.stopPropagation();if(this.closed===!1){this.$handler.trigger("Layout.Panel.minimize");this.minimize()}else{this.$handler.trigger("Layout.Panel.maximize");this.maximize(this.tmpHeight)}}.bind(this));this.toggleHandlerEvents()},addMinimizer:function(e,t){this.$minimizer=n('<div class="minimizer"/>');for(var r=-1,i=t.length;++r<i;)this.orientation===t[r]&&this.$minimizer.appendTo(e)},initializeLayout:function(){var e;i("Layout","Panel","initialize");for(var n=-1,r=t.UI.Layout.prototype.CONST.orientations.length;++n<r;){e=this.$element.find("> ."+t.UI.Layout.prototype.CONST.orientations[n]);if(e.length){this.hasChildren=!0;this.initPanel(e.first(),t.UI.Layout.prototype.CONST.orientations[n])}}},applyStoredDimensions:function(){if(!!this.store){if(this.store.get("PANEL."+this.orientation+".height")!==null){this.updateDimension(null,this.store.get("PANEL."+this.orientation+".height"));this.trigger("Layout.Panel.resize")}if(this.store.get("PANEL."+this.orientation+".width")!==null){this.updateDimension(this.store.get("PANEL."+this.orientation+".width"));this.trigger("Layout.Panel.resize")}this.tmpWidth=this.$element.width();this.tmpHeight=this.$element.height()}},storeDimensions:function(e,t){if(!!this.store){(!!e||e===0)&&this.store.set("PANEL."+this.orientation+".width",e);(!!t||t===0)&&this.store.set("PANEL."+this.orientation+".height",t)}},minimize:function(){if(this.orientation==="west"){this.tmpWidth=this.$element.width();this.updateDimension(this.options.minimizeWidth)}else{this.tmpHeight=this.$element.height();this.updateDimension(null,this.options.minimizeHeight)}this.trigger("Layout.Panel.resize");this.removeEvent(this.$handler,"mousedown");this.toggleHandlerEvents(this.closed);this.closed=!0},maximize:function(){this.orientation==="west"?this.updateDimension(this.tmpWidth):this.updateDimension(null,this.tmpHeight);this.trigger("Layout.Panel.resize");this.removeEvent(this.$handler,"click");this.toggleHandlerEvents(this.closed);this.closed=!1},toggleHandlerEvents:function(e){if(e===!1){this.$handler.css("cursor","pointer");this.$handler.bind("click",function(){this.$handler.trigger("Layout.Panel.maximize");this.maximize(this.tmpHeight)}.bind(this))}else{this.$handler.css("cursor",this.handlerCursor);this.$handler.mousedown(function(e){n(document).on("mousemove.layout",this.resize.bind(this))}.bind(this));this.$handler.mouseup(function(){n(document).off("mousemove.layout")})}},removeEvent:function(e,t){e.unbind(t)},resize:function(e){this.orientation==="west"?this.updateDimension(e.pageX+this.$handler.width()/2):this.updateDimension(null,e.pageY+this.$handler.height()/2);this.trigger("Layout.Panel.resize")},unbusy:function(){this.$element.removeClass("busy")},updateDimension:function(e,t){if(!!e||e===0){this.$element.width(e);this.storeDimensions(e)}if(!!t||t===0){this.$element.height(t);this.storeDimensions(null,t)}this.height=this.$element.outerHeight(!0);this.width=this.$element.outerWidth(!0)},setPositionLeft:function(e){i("Layout","Panel","setPositionLeft",this.orientation);this.$element.css({left:e})},setPositionTop:function(e){i("Layout","Panel","setPositionTop",this.orientation);this.$element.css({top:e})}};t.UI.Modal=function(e){this.$element=null;this.$background=null;this.$header=null;this.$headerTitle=null;this.$headerClose=null;this.$content=null;this.content="";this.$footer=null;this.$footerClose=null;this.footerButtons=[];this.css=[];this.$footerButtons=null;this.options=n.extend({top:!1,bottom:!1,left:!1,right:!1,fadeIn:!1,fadeInDuration:600,fadeOut:!1,fadeOutDuration:600,header:!0,headerTitle:"This is a title",headerTitleClass:"headline",headerClose:!0,headerCloseClass:"close",footer:!0,footerClose:!0,footerCloseClass:"close",footerCloseText:"Cancel",footerButtons:!0,footerButtonsContainerClass:"buttons",footerButtonDefaultClass:"button",overlay:!0,overlayClass:"modalOverlay",overlayColor:"#000000",overlayClose:!0,overlayOpacity:"0.5",draggable:!0,draggableGrid:!1,draggableOnlyOnHeader:!0,resizable:!0,resizeMinWidth:10,resizeMaxWidth:null,resizeMinHeight:10,resizeMaxHeight:null},e);t.MIXIN.Events.enable.call(this);i("Modal","construct",this)};t.UI.Modal.prototype={constructor:t.UI.Layout.Modal,display:function(){this.buildModal();this.buildOverlay();this.initBoxEvents();if(this.options.fadeIn===!0){this.$element.hide();this.$overlay.hide();n("body").append(this.$element);this.setPosition();n("body").append(this.$overlay);this.$element.fadeIn(this.options.fadeInDuration);this.$overlay.fadeTo(this.options.fadeInDuration,this.options.overlayOpacity)}else{n("body").append(this.$element);this.setPosition();n("body").append(this.$overlay)}this.trigger("Modal.activate")},addCSS:function(e,t){this.css.push([e,t])},initCSS:function(){if(this.css!==[])for(var e=-1,t=this.css.length;++e<t;)this.$element.css(this.css[e][0],this.css[e][1])},buildModal:function(){this.initElement();this.initHeader();this.initContent();this.initFooter();this.$element.append(this.$header);this.$element.append(this.$content);this.$element.append(this.$footer)},buildOverlay:function(){if(this.options.overlay===!0){this.$overlay=n('<div class="'+this.options.overlayClass+'"/>');this.$overlay.css({position:"fixed",top:"0px",left:"0px",width:"100%",height:"100%","background-color":this.options.overlayColor})}},initElement:function(){i("Init Element");this.$element=n('<div class="modal"/>');this.initCSS()},initHeader:function(){if(this.options.header===!0){i("Init Header");this.$header=n('<div class="header"/>');if(!!this.options.headerTitle){this.$headerTitle=n('<div class="'+this.options.headerTitleClass+'"/>');this.$headerTitle.html(this.options.headerTitle);this.$header.append(this.$headerTitle)}if(this.options.headerClose===!0){this.$headerClose=n('<div class="'+this.options.headerCloseClass+'"/>');this.$header.append(this.$headerClose)}}},initContent:function(){i("Init Content");this.$content=n('<div class="content"/>');this.$content.html(this.content)},addContent:function(e){this.content=this.content+e},initFooter:function(){if(this.options.footer===!0){i("Init Footer");this.$footer=n('<div class="footer"/>');if(this.options.footerClose===!0){this.$footerClose=n('<div class="'+this.options.footerCloseClass+'"/>');this.$footerClose.html(this.options.footerCloseText);this.$footer.append(this.$footerClose)}if(this.options.footerButtons===!0&&this.footerButtons!==[]){this.initFooterButtons();this.$footer.append(this.$footerButtons)}}},addFooterButtons:function(e){if(typeof e!="object")throw new t.UI.Exception("Buttons argument must be an array but was "+typeof e);for(var n=-1,r=e.length;++n<r;)this.footerButtons.push(e[n])},initFooterButtons:function(){this.$footerButtons=n('<div class="'+this.options.footerButtonsContainerClass+'"/>');for(var e=-1,t=this.footerButtons.length;++e<t;){var r=n("<div/>"),s=this.footerButtons[e].content,o=this.footerButtons[e].callBack||"",u=this.footerButtons[e].cssClass||this.options.footerButtonDefaultClass,a=this.footerButtons[e].elementId;r.html(s);r.addClass(u);r.attr("id",a);r.on("click",o);this.$footerButtons.append(r);i(this.$footerButtons)}},setPosition:function(){this.$element.css("position","absolute");this.options.left!==!1?this.$element.css("left",this.options.left):this.options.right!==!1?this.$element.css("right",this.options.right):this.$element.css({left:"50%","margin-left":"-"+this.$element.outerWidth()/2+"px"});this.options.top!==!1?this.$element.css("top",this.options.top):this.options.bottom!==!1?this.$element.css("bottom",this.options.bottom):this.$element.css({top:"50%","margin-top":"-"+this.$element.outerHeight()/2+"px"})},initBoxEvents:function(){if(this.options.draggable!==!0||this.options.draggableOnlyOnHeader!==!0||!this.$header)this.options.draggable===!0&&this.$element.draggable({grid:this.options.draggableGrid});else{this.$header.on("mousedown",function(){this.$element.draggable({disabled:!1,grid:this.options.draggableGrid})}.bind(this));this.$header.on("mouseup",function(){this.$element.draggable({disabled:!0})}.bind(this))}this.options.resizable===!0&&this.$element.resizable({handles:"se",maxHeight:this.options.resizeMaxHeight,minHeight:this.options.resizeMinHeight,maxWidth:this.options.resizeMaxWidth,minWidth:this.options.resizeMinWidth});!this.$headerClose||this.$headerClose.on("click",function(){this.close()}.bind(this));!this.$footerClose||this.$footerClose.on("click",function(){this.close()}.bind(this));!!this.$overlay&&this.options.overlayClose===!0&&this.$overlay.on("click",function(){this.close()}.bind(this))},close:function(){if(this.options.fadeOut===!0){this.$element.fadeOut(this.options.fadeOutDuration,function(){this.$element.remove()}.bind(this));!this.$overlay||this.$overlay.fadeOut(this.options.fadeOutDuration,function(){this.$overlay.remove()}.bind(this))}else{this.$element.remove();!this.$overlay||this.$overlay.remove()}this.trigger("Modal.deactivate")}};t.UI.Button=function(e,r,s){this.$element=n(e);this.callback=r;this.selected=!1;if(!this.$element.length)throw new t.UI.Exception("Button container does not exist");this.options=n.extend({toggle:!0,toggleBackOnlyOnButton:!0,toggleBackOnMouseLeave:!1,triggerEvent:"click",toggleClass:"active",autoselect:!1,unselect:!0,callBackOnUnselect:!1},s);t.MIXIN.Events.enable.call(this);i("Button","construct",this);this.initialize()};t.UI.Button.prototype={constructor:t.UI.Button,initialize:function(){if(this.options.autoselect===!0){this.select();this.exeCallback()}this.$element.bind(this.options.triggerEvent,function(e){e.stopPropagation();if(this.options.toggle===!1||this.selected===!1){this.select();this.exeCallback()}else if(this.options.unselect===!0){this.unselect();this.exeCallback()}}.bind(this))},select:function(){this.addToggleClass();this.trigger("Button.select");this.selected=!0;this.bindToggleBackHandler()},unselect:function(){this.removeToggleClass();this.trigger("Button.unselect");this.selected=!1},exeCallback:function(){typeof this.callback=="function"&&(this.options.callBackOnUnselect===!0||this.selected===!0)&&this.callback.call()},addToggleClass:function(){this.options.toggle===!0&&this.$element.addClass(this.options.toggleClass)},removeToggleClass:function(){this.options.toggle===!0&&this.$element.removeClass(this.options.toggleClass)},bindToggleBackHandler:function(){this.options.toggleBackOnlyOnButton===!1&&this.options.toggle===!0?n(document).bind(this.options.triggerEvent,function(){this.unselect()}.bind(this)):this.options.toggleBackOnMouseLeave===!0&&this.options.toggle===!0&&this.$element.bind("mouseleave",function(){this.unselect()}.bind(this))}};t.UI.ButtonGroup=function(e,r,s){this.$container=n(e);this.callbacks=r;this.buttons=[];if(!this.$container.length)throw new t.UI.Exception("Button Group container does not exist");this.options=n.extend({dataToggle:!1,buttonClass:"button",buttonOptions:{}},s);t.MIXIN.Events.enable.call(this);i("Button Group","construct",this);this.initialize()};t.UI.ButtonGroup.prototype={constructor:t.UI.ButtonGroup,CONST:{dataToggle:{radio:"radio"}},initialize:function(){this.initButtons();this.initCallbacks()},initButtons:function(){var e=this.$container.find("."+this.options.buttonClass);for(var n=-1,r=e.length;++n<r;){this.buttons[n]=new t.UI.Button(e[n],null,this.options.buttonOptions);this.attachObserver(n)}},initCallbacks:function(){if(!!this.callbacks)for(var e=-1,n=this.callbacks.length;++e<n;){if(!this.buttons[e])throw new t.UI.Exception("Too many Callbacks or not enough buttons");if(typeof this.callbacks[e]!="function")throw new t.UI.Exception("Defined Callback is not a function");this.buttons[e].callback=this.callbacks[e]}},attachObserver:function(e){this.buttons[e].on("Button.select",function(){this.dataToggleHandler(e)}.bind(this))},dataToggleHandler:function(e){if(this.options.dataToggle===this.CONST.dataToggle.radio)for(var t=-1,n=this.buttons.length;++t<n;)this.buttons[t]!==this.buttons[e]&&this.buttons[t].unselect()},getSelectedButtons:function(){var e=[],t=-1,n=this.buttons.length;for(;++t<n;)this.buttons[t].selected===!0&&e.push(this.buttons[t]);return e}};t.UI.Dropdown=function(e,r){this.$activator=n(e);this.$dropdown=null;this.opened=!1;if(!this.$activator.length)throw new t.UI.Exception("Dropdown activator container does not exist");this.options=n.extend({dropdownClass:"dropdown",closeOnClick:!0,closeOnMouseLeave:!1,triggerEvent:"click",resizable:!0,resizeMinWidth:10,resizeMaxWidth:null,resizeMinHeight:10,resizeMaxHeight:null,slideDown:!1,slideDownDuration:500,slideUp:!1,slideUpDuration:500,fadeIn:!1,fadeInDuration:800,fadeOut:!1,fadeOutDuration:800},r);t.MIXIN.Events.enable.call(this);i("Dropdown","construct",this);this.initialize()};t.UI.Dropdown.prototype={constructor:t.UI.Dropdown,initialize:function(){this.getDropdownContainer();this.applyStartingOptions();this.bindEvents()},getDropdownContainer:function(){var e=this.$activator.find("."+this.options.dropdownClass);if(e.length===1)this.$dropdown=e;else{if(e.length>1)throw new t.UI.Exception("More than one Dropdowns found!");if(e.length<1)throw new t.UI.Exception("No Dropdown found!")}},addCSS:function(e){if(typeof e!="object")throw new t.UI.Exception('Type of CSS argument must be "object" but was '+typeof e);this.$dropdown.css(e)},applyStartingOptions:function(){this.$dropdown.hide()},bindEvents:function(){this.$activator.bind(this.options.triggerEvent,function(){this.toggle()}.bind(this));this.$dropdown.bind(this.options.triggerEvent,function(e){e.stopPropagation()});this.options.closeOnClick===!0?n(document).bind("click",function(){this.close()}.bind(this)):this.options.closeOnMouseLeave===!0&&this.$activator.bind("mouseleave",function(){this.close()}.bind(this));this.options.resizable===!0&&this.$dropdown.resizable({handles:"se",maxHeight:this.options.resizeMaxHeight,minHeight:this.options.resizeMinHeight,maxWidth:this.options.resizeMaxWidth,minWidth:this.options.resizeMinWidth})},toggle:function(){this.opened===!1?this.open():this.close()},open:function(){this.options.slideDown===!0?this.$dropdown.slideDown(this.options.slideDownDuration):this.options.fadeIn===!0?this.$dropdown.fadeIn(this.options.fadeInDuration):this.$dropdown.show();this.trigger("Dropdown.open");this.opened=!0},close:function(){this.options.slideUp===!0?this.$dropdown.slideUp(this.options.slideUpDuration):this.options.fadeOut===!0?this.$dropdown.fadeOut(this.options.fadeOutDuration):this.$dropdown.hide();this.trigger("Dropdown.close");this.opened=!1}};t.UI.Tablelist=function(e,r,s){this.$element=n(e);this.pagination={$element:null,$pageentries:null,$back:null,$pagination:null,$next:null};this.$tbody=null;this.$thead=null;this.theadRow={$element:null,$checkboxCont:null,$checkbox:null,titleCells:[]};this.eventsBound=!1;this.tableRows=[];this.allSelected=!1;this.amount=0;this.page=0;this.lastPage=0;this.pageEntries=0;this.sortname="";this.sortType="";this.uri=r;this.jsonObj=null;this.$table=null;if(!this.$element.length)throw new t.UI.Exception("Tablelist element does not exist");this.options=n.extend({tableClass:"tablelist",rowCSSClass:"row",rowClassAddType:"odd",selectable:!0,selectEvent:"click",selectedClass:"selected",checkboxClass:"checkbox",domPagination:!1,calculatePagination:!1,paginationClass:"tablelistnav",navPageEntriesClass:"pageentries",navPaginationClass:"pagination",navPaginationBackClass:"back",navPaginationNextClass:"next",hideNextOnLastPage:!0,hideBackOnFirstPage:!0,sortable:!0,header:!1,pageEntriesSteps:[2,20,50,100,500],descClass:"desc",ascClass:"asc",titleClass:"title",sortParameterName:"sort",sortTypeParameterName:"sortType",pageEntriesParameterName:"pageEntries",pageParameterName:"page"},s);t.MIXIN.Events.enable.call(this);i("Tablelist","construct",this);if(!this.uri){i("Initialize",this);this.initialize()}else{i("Render",this);this.render()}};t.UI.Tablelist.prototype={constructor:t.UI.Tablelist,CONST:{sortTypes:{desc:"desc",asc:"asc"},rowClassAddTypes:{odd:"odd",even:"even"}},initialize:function(){this.getStartingData();this.initTableHeader();this.initTableBody();this.initPagination();this.addCheckboxes();this.bindEvents()},render:function(){this.getStartingData();this.loadJson(this.getURI())},build:function(){this.reset();this.buildTable();this.buildTHeader();this.buildTBody();this.options.domPagination===!0?this.initPagination():this.buildPagination();this.$table.append(this.$thead);this.$table.append(this.$tbody);this.$table.append(this.$tfoot);this.$element.prepend(this.$table);this.$element.append(this.pagination.$element);this.addCheckboxes();this.bindEvents()},reset:function(){!this.$tbody||this.$tbody.html(" ");this.tableRows=[];this.allSelected=!1},getStartingData:function(){this.pageEntries=this.options.pageEntriesSteps[0];this.page=1},loadJson:function(e){n.ajax({url:e,type:"GET",dataType:"JSON",success:function(e){this.jsonObj=e;this.amount=this.jsonObj.amount;this.page=this.jsonObj.page;this.lastPage=Math.ceil(this.amount/this.pageEntries);this.build()}.bind(this),error:function(e,t){}.bind(this)});this.trigger("Tablelist.load")},getPageEntriesOptions:function(){var e='<option value="'+this.options.pageEntriesSteps[0]+'">'+this.options.pageEntriesSteps[0]+"</option>";for(var t=-1,n=this.options.pageEntriesSteps.length;++t<n;){if(!(this.amount>this.options.pageEntriesSteps[t])||!this.options.pageEntriesSteps[t+1])break;this.options.pageEntriesSteps[t+1]===this.pageEntries?e=e+'<option value="'+this.options.pageEntriesSteps[t+1]+'" selected="selected">'+this.options.pageEntriesSteps[t+1]+"</option>":e=e+'<option value="'+this.options.pageEntriesSteps[t+1]+'">'+this.options.pageEntriesSteps[t+1]+"</option>"}return e},getPaginationOptions:function(){var e="";for(var t=0;++t<=this.lastPage;)t===this.page?e=e+'<option selected="selected" value="'+t+'">'+t+"</option>":e=e+'<option value="'+t+'">'+t+"</option>";return e},buildTable:function(){if(!this.$table){i("Build Table");this.$table=n('<table class="'+this.options.tableClass+'"/>'),this.$thead=n("<thead/>"),this.$tbody=n("<tbody/>"),this.$tfoot=n("<tfoot/>")}},buildTHeader:function(){if(!this.theadRow.$element){i("Build Table Header");this.theadRow.$element=n("<tr/>");for(var e=-1,t=this.options.header.length;++e<t;){this.theadRow.titleCells[e]={$element:n("<th>"+this.options.header[e].title+"</th>"),name:this.options.header[e].name,sort:this.options.header[e].sort,sorted:!1,sortType:this.CONST.sortTypes.desc};if(this.theadRow.titleCells[e].$element.html()!==""){i("add");this.theadRow.titleCells[e].$element.addClass(this.options.titleClass)}this.theadRow.$element.append(this.theadRow.titleCells[e].$element);this.bindCellEvents(e)}this.$thead.append(this.theadRow.$element)}},buildTBody:function(){i("Build Table Body");var e,t;for(var r=-1,s=this.jsonObj.items.length;++r<s;){e=n("<tr/>");for(var o=-1,u=this.jsonObj.items[r].length;++o<u;){t=n('<td class="'+this.options.header[o].name+'">'+this.jsonObj.items[r][o]+"</td>");e.append(t)}this.tableRows.push({$element:n(e),$checkboxCell:null,$checkbox:null,selected:!1});this.$tbody.append(this.tableRows[r].$element);this.addRowCSSClass(r);this.bindRowEvents(r)}},buildPagination:function(){if(!this.pagination.$element){this.pagination.$element=n("<div class="+this.options.paginationClass+"/>");this.pagination.$pageentries=n('<div class="'+this.options.navPageEntriesClass+'"/>');this.pagination.$pagination=n('<div class="'+this.options.navPaginationClass+'"/>');this.pagination.$next=n('<a href="#" class="'+this.options.navPaginationNextClass+'">Next</a>');this.pagination.$back=n('<a href="#" class="'+this.options.navPaginationBackClass+'">Back</a>');var e="<span>Page entries</span><select>"+this.getPageEntriesOptions()+"</select>",t="<span>Page</span><select>"+this.getPaginationOptions()+"</select>";this.pagination.$pageentries.append(e);this.pagination.$pagination.append(this.pagination.$back);this.pagination.$pagination.append(t);this.pagination.$pagination.append(this.pagination.$next);this.pagination.$element.append(this.pagination.$pageentries);this.pagination.$element.append(this.pagination.$pagination);this.hidePaginationButtons()}},initTableHeader:function(){this.$thead=this.$element.find("thead");if(this.$thead.length!==1)throw new t.UI.Exception("Table Head initialisation failed");this.theadRow={$element:n(this.$thead.find("tr")),$checkboxCont:null,$checkbox:null,titleCells:[]};if(this.theadRow.$element.length!==1)throw new t.UI.Exception("Table Head row initialisation failed");var e={$element:this.theadRow.$element.find("th")};for(var r=-1,i=e.length;++r<i;){this.theadRow.titleCells.push(n(e[r].$element));n(e[r]).$element.html()!==""&&this.bindCellEvents(r)}},initTableBody:function(){var e=this.$element.find("tbody");if(e.length!==1)throw new t.UI.Exception("Table Body initialisation failed");this.$tbody=e;var r=this.$tbody.find("tr");for(var i=-1,s=r.length;++i<s;){this.tableRows.push({$element:n(r[i]),$checkboxCell:null,$checkbox:null,selected:!1});this.bindRowEvents(i);this.addRowCSSClass(i)}},initPagination:function(){this.pagination.$element=this.$element.find("."+this.options.paginationClass);if(!this.pagination.$element.length)throw new t.UI.Exception("Tablelist pagination element does not exist");this.pagination.$pageentries=this.pagination.$element.find("."+this.options.navPageEntriesClass);this.pagination.$back=this.pagination.$element.find("."+this.options.navPaginationBackClass);this.pagination.$pagination=this.pagination.$element.find("."+this.options.navPaginationClass);this.pagination.$next=this.pagination.$element.find("."+this.options.navPaginationNextClass);if(!this.pagination.$pageentries.length||!this.pagination.$back.length||!this.pagination.$pagination.length||!this.pagination.$next.length)throw new t.UI.Exception("Tablelist pagination initialisation failed");if(this.options.calculatePagination===!0){this.pagination.$pageentries.find("select").html(this.getPageEntriesOptions());this.pagination.$pagination.find("select").html(this.getPaginationOptions())}this.hidePaginationButtons()},hidePaginationButtons:function(){this.options.hideNextOnLastPage===!0&&this.page===this.lastPage?this.pagination.$next.hide():this.pagination.$next.show();this.options.hideBackOnFirstPage===!0&&this.page===1?this.pagination.$back.hide():this.pagination.$back.show()},addCheckboxes:function(){if(this.options.selectable===!0){var e='<input type="checkbox" />'
;for(var t=-1,r=this.tableRows.length;++t<r;){this.tableRows[t].$checkboxCell=n('<td class="'+this.options.checkboxClass+'"/>');this.tableRows[t].$checkbox=n(e);this.tableRows[t].$checkboxCell.append(this.tableRows[t].$checkbox);this.tableRows[t].$element.prepend(this.tableRows[t].$checkboxCell)}if(!this.theadRow.$checkboxCell){this.theadRow.$checkboxCell=n('<th class="'+this.options.checkboxClass+'"/>');this.theadRow.$checkbox=n(e);this.theadRow.$checkboxCell.append(this.theadRow.$checkbox);this.theadRow.$element.prepend(this.theadRow.$checkboxCell)}else this.theadRow.$checkbox.removeAttr("checked")}},addRowCSSClass:function(e){this.options.rowCSSClass!==!1&&(this.options.rowClassAddType===!1?this.tableRows[e].$element.addClass(this.options.rowCSSClass):this.options.rowClassAddType===this.CONST.rowClassAddTypes.odd&&(e+1)%2!==0?this.tableRows[e].$element.addClass(this.options.rowCSSClass):this.options.rowClassAddType===this.CONST.rowClassAddTypes.even&&(e+1)%2===0&&this.tableRows[e].$element.addClass(this.options.rowCSSClass))},bindEvents:function(){if(this.eventsBound===!1){if(this.options.selectable===!0){this.theadRow.$checkbox.on("click",function(){this.toggleAll()}.bind(this));this.on("Tablelist.row.toggle",function(){this.observeSelect()}.bind(this))}this.pagination.$pageentries.on("change",function(){this.changePageEntries()}.bind(this));this.pagination.$pagination.on("change",function(){this.changePage()}.bind(this));this.pagination.$back.on("click",function(){this.changePage(this.page-1)}.bind(this));this.pagination.$next.on("click",function(){this.changePage(this.page+1)}.bind(this));this.eventsBound=!0}},bindRowEvents:function(e){this.options.selectable===!0&&this.tableRows[e].$element.bind(this.options.selectEvent,function(){this.toggle(e)}.bind(this))},bindCellEvents:function(e){this.options.sortable===!0&&this.theadRow.titleCells[e].sort===!0&&this.theadRow.titleCells[e].$element.bind("click",function(){this.sort(this.theadRow.titleCells[e])}.bind(this))},changePageEntries:function(e){e?this.pageEntries=e:this.pageEntries=parseInt(this.pagination.$pageentries.find("select option:selected").val(),10);this.loadJson(this.getURI())},changePage:function(e){if(!e){if(e!==0){this.page=parseInt(this.pagination.$pagination.find("select option:selected").val(),10);this.loadJson(this.getURI())}}else if(e<=this.lastPage){this.page=e;this.loadJson(this.getURI())}},getURI:function(){var e=this.uri+"?"+this.options.sortParameterName+"="+this.sortname+"&"+this.options.sortTypeParameterName+"="+this.sortType+"&"+this.options.pageEntriesParameterName+"="+this.pageEntries+"&"+this.options.pageParameterName+"="+this.page;i(e);return e},sort:function(e){var t;this.sortname=e.name;if(e.sortType===this.CONST.sortTypes.desc){this.sortType=this.CONST.sortTypes.asc;t=this.options.ascClass;e.$element.removeClass(this.options.descClass)}else{this.sortType=this.CONST.sortTypes.desc;t=this.options.descClass;e.$element.removeClass(this.options.ascClass)}e.$element.addClass(t);e.sortType=this.sortType;e.sorted=!0;for(var n=-1,r=this.theadRow.titleCells.length;++n<r;)if(this.theadRow.titleCells[n].name!==e.name){this.theadRow.titleCells[n].$element.removeClass(this.options.ascClass);this.theadRow.titleCells[n].$element.removeClass(this.options.descClass);this.theadRow.titleCells[n].sorted=!1;this.theadRow.titleCells[n].sortType=this.CONST.sortTypes.desc}this.loadJson(this.getURI());this.trigger("Tablelist.sort")},toggle:function(e){this.tableRows[e].selected===!1?this.select(e):this.unselect(e);this.trigger("Tablelist.row.toggle")},select:function(e){this.tableRows[e].$element.addClass(this.options.selectedClass);this.tableRows[e].$checkbox.attr("checked",!0);this.tableRows[e].selected=!0;this.trigger("Tablelist.row.select")},unselect:function(e){this.tableRows[e].$element.removeClass(this.options.selectedClass);this.tableRows[e].$checkbox.attr("checked",!1);this.tableRows[e].selected=!1;this.trigger("Tablelist.row.unselect")},toggleAll:function(){if(this.allSelected===!1){this.selectAll();this.allSelected=!0}else{this.unselectAll();this.allSelected=!1}this.trigger("Tablelist.toggleall")},selectAll:function(){for(var e=-1,t=this.tableRows.length;++e<t;)this.select(e);this.trigger("Tablelist.selectall")},unselectAll:function(){for(var e=-1,t=this.tableRows.length;++e<t;)this.unselect(e);this.trigger("Tablelist.unselectall")},observeSelect:function(){var e=!0;for(var t=-1,n=this.tableRows.length;++t<n;)if(this.tableRows[t].selected===!1){e=!1;break}this.allSelected=e;this.theadRow.$checkbox.attr("checked",e)},getSelectedRows:function(){var e=[];for(var t=-1,n=this.tableRows.length;++t<n;)this.tableRows[t].selected===!0&&e.push(this.tableRows[t].$element);return e}}})(window,window.ZOOLU,window.jQuery);