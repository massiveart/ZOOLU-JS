Function.prototype.bind||(Function.prototype.bind=function(e){if(typeof this!="function")throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,r=function(){},i=function(){return n.apply(this instanceof r?this:e||window,t.concat(Array.prototype.slice.call(arguments)))};r.prototype=this.prototype;i.prototype=new r;return i});window.log=function(){this.log.history=this.log.history||[];this.log.history.push(arguments);this.console&&this.console.log(Array.prototype.slice.call(arguments))};window.debug=!1;(function(e,t,n){"use strict";function r(){e.debug&&e.log.apply(e,t.merge(["ZOOLU"],arguments))}var i;i={version:"2.0.0.alpha1"};e.ZOOLU=e.$z=i})(window,window.jQuery);(function(e,t,n,r){"use strict";function i(){e.debug&&e.log.apply(e,n.merge(["ZOOLU","UTIL"],arguments))}t.UTIL={};t.UTIL.String={truncate:function(e,t){i("String","truncate");return typeof e!="string"?"":e.length>t?e.slice(0,t-3)+"...":e},truncateAtWordBoundaries:function(e,t){i("String","truncateAtWordBoundaries");var n,r;if(typeof e!="string")return"";n=e.split("");if(n.length>t){for(r=n.length-1;r>-1;--r)if(r>=t)n.length=r;else if(" "===n[r]){n.length=r;break}n.push(" ...")}return n.join("")},truncateInBetween:function(e,t,n){i("String","truncateAtTheMiddle");if(typeof e!="string")return"";if(e.length>t){n=n||" ... ";var r=n.length,s=t-r,o=Math.ceil(s/3*2),u=Math.floor(s/3*1);return e.substr(0,o)+n+e.substr(e.length-u)}return e}}})(window,window.ZOOLU,window.jQuery);(function(e,t,n,r){"use strict";function i(){e.debug&&e.log.apply(e,n.merge(["ZOOLU","MIXIN"],arguments))}t.MIXIN={};t.MIXIN.Events={enable:function(){this.listeners||(this.listeners={});this.trigger=function(e,n){t.MIXIN.Events.trigger.call(this,e,n)}.bind(this);this.on=function(e,n){t.MIXIN.Events.on.call(this,e,n)}.bind(this);this.off=function(e,n){t.MIXIN.Events.off.call(this,e,n)}.bind(this)},trigger:function(t,n){if(!!this.listeners[t]){n===r&&(n=[]);for(var i=-1,s=this.listeners[t].length;++i<s;)this.listeners[t][i].apply(e,n)}},on:function(e,t){this.listeners[e]||(this.listeners[e]=[]);t instanceof Function&&this.listeners[e].push(t)},off:function(e,t){if(!!this.listeners[e]&&this.listeners[e].length>0)if(!t)this.listeners[e]=[];else{var n=[];for(var r=-1,i=this.listeners[e].length;++r<i;)t!==this.listeners[e][r]&&n.push(this.listeners[e][r]);this.listeners[e]=n}}}})(window,window.ZOOLU,window.jQuery);(function(e,t,n,r){"use strict";function i(){e.debug&&e.log.apply(e,n.merge(["ZOOLU","UI"],arguments))}t.UI={};t.UI.Exception=function(e){this.name="ZOOLU.UI.Exception";this.message=e||"Something went wrong!"};t.UI.Exception.prototype={constructor:t.UI.Exception,toString:function(){return this.name+': "'+this.message+'"'}};t.UI.ColumnTree=function(e,r){this.$container=n(e);if(!this.$container.length)throw new t.UI.Exception("ColumnTree container doesn't exist!");this.$container.addClass("column-tree");this.options=n.extend({hasChildren:{},urlAddOnForLoadingNodeChildren:"/children",rowMaxLength:30},r);this.level=0;this.selectedId=null;this.selectedElementIds=[];this.$selected=null;this.$currentColumn=null;this.data=[];t.MIXIN.Events.enable.call(this);i("ColumnTree","construct",this);this.load()};t.UI.ColumnTree.prototype={constructor:t.UI.ColumnTree,load:function(){i("ColumnTree","load");if(this.options.url){this.trigger("ColumnTree.load");this.$container.find(".column").length<=this.level&&this.addColumn();this.$currentColumn=n("#column-"+this.level);this.$currentColumn.addClass("busy");n.ajax({url:this.selectedId?this.options.url+"/"+this.selectedId+this.options.urlAddOnForLoadingNodeChildren:this.options.url,type:"GET",dataType:"JSON",success:function(e){i("ColumnTree","load","success",e);this.updateData(e);this.updateView()}.bind(this),error:function(e,t){i("ColumnTree","load","error",t);this.$currentColumn.removeClass("busy")}.bind(this)})}},updateData:function(e){i("ColumnTree","updateData");this.data[this.level]=e},updateView:function(){i("ColumnTree","updateView");if(!this.$currentColumn.length)throw new t.UI.Exception("Current column not found!");this.$currentColumn.removeClass("busy");this.$list=n('<ul class="list"/>');for(var e=-1,r=this.data[this.level].length;++e<r;)this.prepareRow(this.data[this.level][e]).appendTo(this.$list);this.$currentColumn.html(this.$list);delete this.$row;delete this.$list},addColumn:function(){i("ColumnTree","addColumn");this.$container.append(n('<div class="column"/>').attr("id","column-"+this.level).data("level",this.level))},prepareRow:function(e){i("ColumnTree","prepareRow",arguments);this.$row=n('<li class="row '+e.type+'"/>').attr("id","row-"+e.id+"-"+e.type);this.$row.html(t.UTIL.String.truncateInBetween(e.name,this.options.rowMaxLength));this.$row.data("id",e.id);this.$row.data("type",e.type);this.$row.data("level",this.level);this.attachRowObservers(e);return this.$row},attachRowObservers:function(){i("ColumnTree","attachRowObservers",arguments);this.$row.on("click",function(e){this.select(e.target)}.bind(this))},select:function(e){i("ColumnTree","select",arguments);this.$selected=n(e);this.selectedId=this.$selected.data("id");this.level=this.$selected.data("level");this.trigger("ColumnTree.select",[this.$selected]);this.updateSelectedMarker();this.$container.find(".column").each(function(e,t){if(n(t).data("level")>this.level){n(t).html("");delete this.data[n(t).data("level")];delete this.selectedElementIds[n(t).data("level")]}}.bind(this));if(this.options.hasChildren.hasOwnProperty(this.$selected.data("type"))&&this.options.hasChildren[this.$selected.data("type")]===!0){this.level++;this.load()}},updateSelectedMarker:function(){i("ColumnTree","updateSelectedMarker");if(this.selectedElementIds[this.level]){i(n("#"+this.selectedElementIds[this.level]));n("#"+this.selectedElementIds[this.level]).removeClass("selected")}this.$selected.addClass("selected");this.selectedElementIds[this.level]=this.$selected.attr("id")}};t.UI.Layout=function(e,r){this.$container=n(e);if(!this.$container.length)throw new t.UI.Exception("Layout container doesn't exist!");this.$container.addClass("layout");this.$container.addClass("busy");this.height=this.$container.outerHeight(!0);this.width=this.$container.outerWidth(!0);this.panels={};this.options=n.extend({fullScreen:!0},r);t.MIXIN.Events.enable.call(this);i("Layout","construct",this);this.initialize()};t.UI.Layout.prototype={constructor:t.UI.Layout,CONST:{orientations:["west","north","center"]},initialize:function(){var t;i("Layout","initialize");if(this.options.fullScreen){n("html").css({height:"100%",overflow:"hidden",overflowX:"hidden",overflowY:"hidden"});n("body").css({position:"relative",height:"100%",overflow:"hidden",overflowX:"hidden",overflowY:"hidden",margin:0,padding:0,border:"none"})}for(var r=-1,s=this.CONST.orientations.length;++r<s;){t=this.$container.find("> ."+this.CONST.orientations[r]);t.length&&this.initPanel(t.first(),this.CONST.orientations[r])}this.arrange();n(e).resize(this.arrange.bind(this))},enable:function(){this.initPanel=function(e,n){t.UI.Layout.prototype.initPanel.call(this,e,n)}.bind(this);this.addPanel=function(e){t.UI.Layout.prototype.addPanel.call(this,e)}.bind(this);this.arrange=function(){t.UI.Layout.prototype.arrange.call(this)}.bind(this)},initPanel:function(e,n){i("Layout","initPanel",arguments);this.addPanel(new t.UI.Layout.Panel(e,this,n,this.options))},addPanel:function(e){i("Layout","addPanel",arguments);this.panels[e.orientation]=e;e.on("Layout.Panel.resize",this.arrange.bind(this))},arrange:function(){this.layout?i("Layout","Panel","arrange"):i("Layout","arrange");this.updateDimension();this.left=0;if(this.panels.hasOwnProperty("west")){this.panels.west.setPositionLeft(this.left);this.left+=this.panels.west.width}this.top=0;if(this.panels.hasOwnProperty("north")){this.panels.north.setPositionTop(this.top);this.top+=this.panels.north.height}if(this.panels.hasOwnProperty("center")){this.panels.center.setPositionLeft(this.left);this.panels.center.setPositionTop(this.top);this.panels.center.updateDimension(this.left===0?"100%":this.width-this.left,this.top===0?"100%":this.height-this.top);this.panels.center.hasChildren&&this.panels.center.arrange()}this.unbusy()},unbusy:function(){this.$container.removeClass("busy")},updateDimension:function(e,t){!e||this.$container.width(e);!t||this.$container.height(t);this.height=this.$container.outerHeight(!0);this.width=this.$container.outerWidth(!0)}};t.UI.Layout.Panel=function(e,r,s,o){this.$element=n(e);this.layout=r;this.orientation=s;this.hasChildren=!1;this.handler=null;if(!this.$element.length)throw new t.UI.Exception("Panel doesn't exist!");this.$element.addClass("panel");this.height=this.$element.outerHeight(!0);this.width=this.$element.outerWidth(!0);this.options=n.extend({},o);t.MIXIN.Events.enable.call(this);i("Layout","Panel","construct",this);this.initialize();if(this.orientation==="center"){t.UI.Layout.prototype.enable.call(this);this.panels={};this.initializeLayout()}};t.UI.Layout.Panel.prototype={constructor:t.UI.Layout.Panel,initialize:function(){this.$handler=n('<div class="handler"/>');this.$handler.appendTo(this.$element);this.$handler.mousedown(function(t){t.preventDefault();n(e).on("mousemove.layout",this.resize.bind(this))}.bind(this));n(e).mouseup(function(){n(e).off("mousemove.layout")})},initializeLayout:function(){var e;i("Layout","Panel","initialize");for(var n=-1,r=t.UI.Layout.prototype.CONST.orientations.length;++n<r;){e=this.$element.find("> ."+t.UI.Layout.prototype.CONST.orientations[n]);if(e.length){this.hasChildren=!0;this.initPanel(e.first(),t.UI.Layout.prototype.CONST.orientations[n])}}},resize:function(e){this.orientation==="west"?this.updateDimension(e.pageX+this.$handler.width()/2):this.updateDimension(null,e.pageY+this.$handler.height()/2);this.trigger("Layout.Panel.resize")},unbusy:function(){this.$element.removeClass("busy")},updateDimension:function(e,t){!e||this.$element.width(e);!t||this.$element.height(t);this.height=this.$element.outerHeight(!0);this.width=this.$element.outerWidth(!0)},setPositionLeft:function(e){i("Layout","Panel","setPositionLeft",this.orientation);this.$element.css({left:e})},setPositionTop:function(e){i("Layout","Panel","setPositionTop",this.orientation);this.$element.css({top:e})}}})(window,window.ZOOLU,window.jQuery);